Info3: <<
Package: orange-gui-dev-py%type_pkg[python]
Type: python (2.6 2.7)
Version: __VERSION__
Revision: 1
Source: __SOURCE__
Source-MD5: __MD5SUM__
Source2: http://orange.biolab.si/fink/dists/10.6/main/source/orange-bundlelite-svn-0.0.12741.tgz
Source2-MD5: b333b6b54a50685dddb75ba21df73617
Maintainer: Mitar <mitar@tnode.com>
HomePage: http://orange.biolab.si/
License: GPL
Depends: <<
	python%type_pkg[python],
	orange-dev-py%type_pkg[python] (>= %v),
	pyqt4-mac-py%type_pkg[python] (>= 4.4),
	pyqwt-qt4mac-py%type_pkg[python] (>= 5.1),
	opengl-py%type_pkg[python],
	sip-py%type_pkg[python],
	graphviz,
	distribute-py%type_pkg[python]
<<
BuildDepends: <<
	qt4-base-mac,
	sip-py%type_pkg[python]-bin,
	pyqt4-mac-py%type_pkg[python],
	cmake
<<
# Conflicts other versions because of app bundle
Conflicts: orange-gui-svn-py%type_pkg[python], orange-dev
Replaces: orange-gui-svn-py%type_pkg[python], orange-dev-py%type_pkg[python]
Description: Data mining framework (GUI)
DescDetail: <<
	Orange is a component-based data mining software. It includes a range
	of data visualization, exploration, preprocessing and modeling
	techniques. It can be used through a nice and intuitive user interface
	or, for more advanced users, as a module for Python programming language.
	
	This package provides a graphical user interface.
<<
AppBundles: ../orange-bundlelite-svn-0.0.12741/Orange-%type_pkg[python].app
Shlibs: <<
	%p/lib/python%type_raw[python]/site-packages/orangeqt.so 0.0.0 %n (>= 0.0.0-1)
<<
SplitOff: <<
	Package: orange-dev-py%type_pkg[python]
	Depends: <<
		python%type_pkg[python],
		numpy-py%type_pkg[python],
		pil-py%type_pkg[python],
		networkx-py%type_pkg[python]
	<<
	Suggests: orange-gui-dev-py%type_pkg[python]
	Conflicts: orange-svn-py%type_pkg[python]
	Replaces: orange-svn-py%type_pkg[python]
	Description: Data mining framework (Python module)
	DescDetail: <<
		Orange is a component-based data mining software. It includes a range
		of data visualization, exploration, preprocessing and modeling
		techniques. It can be used through a nice and intuitive user interface
		or, for more advanced users, as a module for Python programming language.
		
		This package provides a Python module.
	<<
	Files: <<
		lib/python%type_raw[python]/site-packages/Orange/*
		lib/python%type_raw[python]/site-packages/Orange-orng-modules.pth
		lib/python%type_raw[python]/site-packages/Orange-*-py%type_raw[python].egg-info
		share/doc/orange-dev-py%type_pkg[python]
		bin/orange-canvas%type_raw[python]
	<<
<<
CompileScript: <<
	#!/bin/bash -ev
	
	export CPPFLAGS="-O0 -g0"
	export LDFLAGS="-O0 -g0"

	# Build orange
	%p/bin/python%type_raw[python] setup.py build
	
	# To build orangeqt module we need to force cmake to look in
	# the proper places.
	
	# For cmake to find qmake
	export PATH=%p/lib/qt4-mac/bin:$PATH
	# And cmake to find PyQt4
	export PYTHONPATH=%p/lib/qt4-mac/lib/python%type_raw[python]/site-packages/
	
	# Try every thing possible to convince cmake to use our python
	export PATH=%b:$PATH
	ln -s %p/bin/python%type_raw[python] python
	ln -s %p/bin/python%type_raw[python] python%type_raw[python]

	# Finally compile orangeqt 
	cd source/orangeqt
	mkdir build
	cd build
	cmake -DCMAKE_BUILD_TYPE=Release -DPython_ADDITIONAL_VERSIONS=%type_raw[python] -DCMAKE_LIBRARY_PATH=%p/lib -DCMAKE_SYSTEM_IGNORE_PATH=/usr/lib ../
	make VERBOSE=1
	cd ../../../
	
	# Clean up the python sym links 
	rm python
	rm python%type_raw[python]
	
	# Prepares bundle
	cat <<-'EOF' > ../orange-bundlelite-svn-0.0.12741/Orange.app/Contents/MacOS/Orange
		#!/bin/bash
		. %p/bin/init.sh
		CANVAS_FILE="%p/lib/python%type_raw[python]/site-packages/Orange/OrangeCanvas/orngCanvas.pyw"
		export PYTHONPATH="%p/lib/qt4-mac/lib/python%type_raw[python]/site-packages${PYTHONPATH:+:$PYTHONPATH}"
		# LaunchServices passes the Carbon process identifier to the application with -psn parameter - we do not want it
		if [[ "\$1" == -psn* ]] ; then
			shift
		fi
		exec -a "$0" %p/bin/python%type_raw[python] "$CANVAS_FILE" "$@"
	EOF
	chmod +x ../orange-bundlelite-svn-0.0.12741/Orange.app/Contents/MacOS/Orange
	mv ../orange-bundlelite-svn-0.0.12741/Orange.app ../orange-bundlelite-svn-0.0.12741/Orange-%type_pkg[python].app
<<
InstallScript: <<
	#!/bin/bash -ev
	
	%p/bin/python%type_raw[python] setup.py install --root=%d --single-version-externally-managed
	
	# Also install orangeqt module
	mv source/orangeqt/build/orangeqt.so  %i/lib/python%type_raw[python]/site-packages/
	
	# Fix install name id
	install_name_tool -id %p/lib/python%type_raw[python]/site-packages/orangeqt.so %i/lib/python%type_raw[python]/site-packages/orangeqt.so
	
	# Register dataset path
	# TODO: this should be done by setup.py install and using global orangerc.cfg file
	echo "datasetsPath=\"%p/share/doc/orange-svn-py%type_pkg[python]/datasets/\"" > %i/lib/python%type_raw[python]/site-packages/Orange/orng/orngConfiguration.py	

	# Documentation for orange-gui-dev-py
	mkdir -p %i/share/doc/orange-gui-dev-py%type_pkg[python]/
	cp COPYING LICENSES %i/share/doc/orange-gui-dev-py%type_pkg[python]/
	cp Orange/doc/style.css %i/share/doc/orange-gui-dev-py%type_pkg[python]/
	mv Orange/doc/widgets/ %i/share/doc/orange-gui-dev-py%type_pkg[python]/
	
	# Documentation for orange-dev-py
	mkdir -p %i/share/doc/orange-dev-py%type_pkg[python]/
	cp COPYING LICENSES %i/share/doc/orange-dev-py%type_pkg[python]/
	mv Orange/doc/* %i/share/doc/orange-dev-py%type_pkg[python]/

	# Add python version to bin/orange-canvas script
	mv %i/bin/orange-canvas %i/bin/orange-canvas%type_raw[python]
<<
<<
